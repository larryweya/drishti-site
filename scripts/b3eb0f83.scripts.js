"use strict";angular.module("drishtiSiteApp",["ngCookies"]).constant("AUTH_URL","https://drishti.modilabs.org/authenticate-user").constant("REPORT_DATASET","0f07189134224f089a1a53e0aa5fb19c").config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/indicators-month/:indicator",{templateUrl:"views/indicators-month.html",controller:"IndicatorMonthCtrl"}).when("/indicators-cumulative/:indicator",{templateUrl:"views/indicators-cumulative.html",controller:"IndicatorCumulativeCtrl"}).when("/registers",{templateUrl:"views/registers.html",controller:"MainCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","$window","Authentication",function(a,b,c,d){a.$on("$locationChangeStart",function(e,f){d.isAuthenticated()||null!==f.match(/\/login/)||(b.path("/login"),a.$$phase?c.location="#/login":a.$apply())}),a.$on("$locationChangeSuccess",function(){})}]),angular.module("drishtiSiteApp").value("ReportsDefinitions",{fp:{name:"Family Planning Services",services:["IUD","CONDOM","OCP","MALE_STERILIZATION","FEMALE_STERILIZATION"]},anc:{name:"ANC Services",services:["EARLY_ANC_REGISTRATIONS","ANC_REGISTRATIONS","SUB_TT","TT1","TT2","TTB","ANC4"]},"pregnancy-outcomes":{name:"Pregnancy Outcomes",services:["LIVE_BIRTH","STILL_BIRTH","EARLY_ABORTIONS","LATE_ABORTIONS","SPONTANEOUS_ABORTION","DELIVERY","INSTITUTIONAL_DELIVERY","D_HOM","D_SC","D_PHC","D_CHC","D_SDH","D_DH","D_PRI"]},pnc:{name:"PNC Services",services:["PNC3"]},mortality:{name:"Mortality",services:["ENM","NM","LNM","INFANT_MORTALITY","CHILD_MORTALITY","MMA","MMD","MMP","MM"]},"child-services":{name:"Child Services",services:["DPT3_OR_OPV3","DPT_BOOSTER_OR_OPV_BOOSTER","DPT_BOOSTER2","HEP","OPV","MEASLES","BCG","LBW","BF_POST_BIRTH","WEIGHED_AT_BIRTH","VIT_A_1","VIT_A_2"]}}).service("Authentication",["$cookieStore","BasicAuth",function(a,b){return{authenticate:function(a,c){b.setCredentials(a,c)},isAuthenticated:function(){return!!a.get("authdata")}}}]).service("BasicAuth",["Base64","$cookieStore","$http",function(a,b,c){return c.defaults.headers.common.Authorization="Basic "+b.get("authdata"),{setCredentials:function(d,e){var f=a.encode(d+":"+e);c.defaults.headers.common.Authorization="Basic "+f,b.put("authdata",f)},clearCredentials:function(){document.execCommand("ClearAuthenticationCache"),b.remove("authdata"),c.defaults.headers.common.Authorization="Basic "}}}]).service("Base64",function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(b){var c,d,e,f,g,h="",i="",j="",k=0;do c=b.charCodeAt(k++),d=b.charCodeAt(k++),i=b.charCodeAt(k++),e=c>>2,f=(3&c)<<4|d>>4,g=(15&d)<<2|i>>6,j=63&i,isNaN(d)?g=j=64:isNaN(i)&&(j=64),h=h+a.charAt(e)+a.charAt(f)+a.charAt(g)+a.charAt(j),c=d=i="",e=f=g=j="";while(k<b.length);return h},decode:function(b){var c,d,e,f,g,h="",i="",j="",k=0,l=/[^A-Za-z0-9\+\/\=]/g;l.exec(b)&&alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");do e=a.indexOf(b.charAt(k++)),f=a.indexOf(b.charAt(k++)),g=a.indexOf(b.charAt(k++)),j=a.indexOf(b.charAt(k++)),c=e<<2|f>>4,d=(15&f)<<4|g>>2,i=(3&g)<<6|j,h+=String.fromCharCode(c),64!=g&&(h+=String.fromCharCode(d)),64!=j&&(h+=String.fromCharCode(i)),c=d=i="",e=f=g=j="";while(k<b.length);return h}}}).service("BambooAPI",["$q","$rootScope",function(a,b){var c=function(a){b.$$phase?a():b.$apply(a)};return{queryInfo:function(b){var d=a.defer(),e=new bamboo.Dataset({id:b});return e.query_info(function(a){c(function(){d.resolve(a)})}),d.promise},querySummary:function(b,d,e){var f=a.defer(),g=new bamboo.Dataset({id:b});return g.summary(d,e,function(a){c(function(){f.resolve(a)})}),f.promise},queryCalculations:function(b){var d=a.defer(),e=new bamboo.Dataset({id:b});return e.query_calculations(function(a){c(function(){d.resolve(a)})}),d.promise},addCalculation:function(b,d,e){var f=a.defer(),g=new bamboo.Dataset({id:b});return g.add_calculation(d,e,function(a){c(function(){f.resolve(a)})}),f.promise},removeCalculation:function(a,b){var c=new bamboo.Dataset({id:a});c.remove_calculation(b)}}}]),angular.module("drishtiSiteApp").controller("LoginCtrl",["$scope","$location","$http","$window","Authentication",function(a,b,c,d,e){a.loginUser=function(){"c"===a.username&&"1"===a.password&&(e.authenticate(a.username,a.password),b.path("#/"),a.$$phase?d.location="#/":a.$apply())}}]).controller("MainCtrl",["$scope",function(a){a.iudUsers=[{registrationDate:"2013-03-02",ecNumber:"2",wifeName:"Rani",husbandName:"Raja",village:"Keelanapura",womanDOB:"1984-08-01",husbandDOB:"1983-01-01",caste:"sc",religion:"hindu",wifeEducationLevel:"illiterate",husbandEducationLevel:"illiterate",lmp:"2012-06-02",upt:"-ve",maleChildren:"2",femaleChildren:"0",method:"iud",iudDateOfInsertion:"2013-04-01",iudPlaceOfInsertion:"phc",iudInserterName:"bhagya",remarks:"Needs medical attention"},{registrationDate:"2013-03-02",ecNumber:"2",wifeName:"Rani",husbandName:"Raja",village:"Keelanapura",womanDOB:"1984-08-01",husbandDOB:"1983-01-01",caste:"sc",religion:"hindu",wifeEducationLevel:"illiterate",husbandEducationLevel:"illiterate",lmp:"2012-06-03",upt:"-ve",maleChildren:"2",femaleChildren:"1",method:"iud",iudDateOfInsertion:"2013-04-01",iudPlaceOfInsertion:"phc",iudInserterName:"bhagya",remarks:"None"},{registrationDate:"2013-03-02",ecNumber:"2",wifeName:"Rani",husbandName:"Raja",village:"Keelanapura",womanDOB:"1984-08-01",husbandDOB:"1983-01-01",caste:"sc",religion:"hindu",wifeEducationLevel:"illiterate",husbandEducationLevel:"illiterate",lmp:"2012-06-03",upt:"-ve",maleChildren:"0",femaleChildren:"2",method:"iud",iudDateOfInsertion:"2013-04-01",iudPlaceOfInsertion:"phc",iudInserterName:"bhagya",remarks:"medicines prescribed"},{registrationDate:"2013-03-02",ecNumber:"2",wifeName:"Rani",husbandName:"Raja",village:"Keelanapura",womanDOB:"1984-08-01",husbandDOB:"1983-01-01",caste:"sc",religion:"hindu",wifeEducationLevel:"illiterate",husbandEducationLevel:"illiterate",lmp:"2012-06-03",upt:"-ve",maleChildren:"0",femaleChildren:"1",method:"iud",iudDateOfInsertion:"2013-04-01",iudPlaceOfInsertion:"phc",iudInserterName:"bhagya",remarks:"Should consult a doctor"}]}]).controller("IndicatorMonthCtrl",["$scope","$routeParams","ReportsDefinitions","BambooAPI","REPORT_DATASET",function(a,b,c,d,e){a.indicator=b.indicator;var f=c[a.indicator],g=d.querySummary(e,{indicator:1},"service_provider");a.services_provided=f.services,g.then(function(b){a.service_providers=Object.keys(b.service_provider),a.data=b.service_provider,a.data.totals={service_providers:{},services_provided:{},all:0},a.service_providers.forEach(function(c){var d=0,e=b.service_provider[c].indicator.summary;a.services_provided.forEach(function(a){d+=e[a]||0}),a.data.totals.service_providers[c]=d});var c=0;a.services_provided.forEach(function(d){var e=0;a.service_providers.forEach(function(a){e+=b.service_provider[a].indicator.summary[d]||0}),a.data.totals.services_provided[d]=e,c+=e}),a.data.totals.all=c})}]).controller("IndicatorCumulativeCtrl",["$scope","$routeParams","ReportsDefinitions","BambooAPI","REPORT_DATASET",function(a,b){a.indicator=b.indicator}]);